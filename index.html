<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Analog Vol1. ìœ íŠœë¸Œ ì¡°íšŒìˆ˜</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gradient-to-br from-purple-50 to-pink-50 min-h-screen p-4">
    
    <div class="max-w-7xl mx-auto">
        <div class="bg-white rounded-2xl shadow-xl p-6 mb-6">
            <!-- í—¤ë” -->
            <div class="flex items-center justify-between mb-6 flex-wrap gap-4">
                <div>
                    <h1 class="text-3xl font-bold text-gray-800">ğŸµ Analog Vol1. ìœ íŠœë¸Œ ì¡°íšŒìˆ˜ ì¦ê°</h1>
                    <p id="lastUpdate" class="text-sm text-gray-500 mt-1"></p>
                </div>
                <div class="flex gap-2">
                    <button onclick="copyLink()" class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700">
                        ğŸ“‹ <span id="copyText">ë§í¬ ë³µì‚¬</span>
                    </button>
                    <button onclick="toggleAdmin()" id="adminBtn" class="bg-purple-600 text-white px-4 py-2 rounded-lg hover:bg-purple-700">
                        ğŸ” ê´€ë¦¬ì
                    </button>
                    <button onclick="saveData()" id="saveBtn" class="hidden bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700">
                        ğŸ’¾ ì €ì¥
                    </button>
                </div>
            </div>

            <!-- ê³¡ ëª©ë¡ -->
            <div id="songs"></div>
        </div>

        <!-- ì „ì²´ í†µê³„ -->
        <div class="text-center text-lg font-semibold text-gray-700">
            ì´ 12ê³¡ | ì „ì²´ í‰ê·  ë‹¬ì„±ë¥ : <span id="avgRate" class="text-purple-600">0.0%</span>
        </div>
    </div>

    <!-- ë¡œê·¸ì¸ ëª¨ë‹¬ -->
    <div id="modal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
        <div class="bg-white rounded-xl p-8 max-w-md w-full mx-4">
            <h2 class="text-2xl font-bold mb-4">ê´€ë¦¬ì ë¡œê·¸ì¸</h2>
            <input type="password" id="pwd" placeholder="ë¹„ë°€ë²ˆí˜¸" class="w-full px-4 py-3 border rounded-lg mb-4">
            <div id="error" class="hidden text-red-600 text-sm mb-4"></div>
            <div class="flex gap-3">
                <button onclick="closeModal()" class="flex-1 px-4 py-3 border rounded-lg">ì·¨ì†Œ</button>
                <button onclick="login()" class="flex-1 bg-purple-600 text-white px-4 py-3 rounded-lg">ë¡œê·¸ì¸</button>
            </div>
        </div>
    </div>

    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    <script>
        const SONGS = [
            'Hankyeryeong Pass', 'Lonely Love', 'My Reflection in My Heart',
            'ë‚´ ê³ì— ìˆì–´ì£¼ | ì•¼ì™¸ë…¹ìŒì‹¤', "I'll Give You the Love I Have Left",
            'Just a Friend', 'That Day', 'I will let go',
            'ë‚´ ê³ì— ìˆì–´ì£¼ Official MV', 'Stay by My Side | 1theK',
            'í•œê³„ë ¹ Official MV', 'Hankyeryeong Pass | 1theK'
        ];

        let isAdmin = false;
        let db;
        let data = {
            times: ['ì‹œê°„1', 'ì‹œê°„2', 'ì‹œê°„3', 'ì‹œê°„4', 'ì‹œê°„5'],
            goals: Array(12).fill(100000),
            views: Array(12).fill(null).map(() => [0,0,0,0,0])
        };

        // Firebase ì´ˆê¸°í™”
        firebase.initializeApp({
            apiKey: "AIzaSyDk0r98Ag5htVKH-vVxUzG52SYNcX1G0sA",
            authDomain: "analog-vol1-mv.firebaseapp.com",
            databaseURL: "https://analog-vol1-mv-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "analog-vol1-mv",
            storageBucket: "analog-vol1-mv.firebasestorage.app",
            messagingSenderId: "40601613117",
            appId: "1:40601613117:web:de43110328bc627df14b54"
        });
        db = firebase.database();

        // ë°ì´í„° ë¡œë“œ
        db.ref('tracker').on('value', snap => {
            const val = snap.val();
            if (val) {
                data = val;
                if (val.lastUpdate) {
                    document.getElementById('lastUpdate').textContent = 'ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸: ' + val.lastUpdate;
                }
            }
            render();
        });

        function fmt(n) {
            return n.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ',');
        }

        function getLatest(views) {
            for (let i = 4; i >= 0; i--) {
                if (views[i] > 0) return views[i];
            }
            return 0;
        }

        function getRate(views, goal) {
            const latest = getLatest(views);
            return goal > 0 ? Math.min((latest / goal) * 100, 100) : 0;
        }

        function render() {
            let html = '<div class="space-y-4">';
            let totalRate = 0;

            SONGS.forEach((song, i) => {
                const rate = getRate(data.views[i], data.goals[i]);
                const latest = getLatest(data.views[i]);
                totalRate += rate;

                html += `
                    <div class="border rounded-xl p-4 bg-gray-50">
                        <div class="flex justify-between items-start mb-3">
                            <h3 class="font-bold text-lg">${song}</h3>
                            <div class="text-right text-sm">
                                <div>ëª©í‘œ: ${isAdmin ? 
                                    `<input type="number" value="${data.goals[i]}" onchange="data.goals[${i}]=+this.value;render()" 
                                    class="w-28 px-2 py-1 border-2 border-purple-400 rounded bg-yellow-50 font-bold">` 
                                    : `<span class="font-bold text-purple-600">${fmt(data.goals[i])}</span>`}
                                </div>
                                <div>í˜„ì¬: <span class="font-bold text-blue-600">${fmt(latest)}</span></div>
                                <div>ë‹¬ì„±ë¥ : <span class="font-bold text-green-600">${rate.toFixed(1)}%</span></div>
                            </div>
                        </div>
                        <div class="w-full bg-gray-200 rounded-full h-2 mb-3">
                            <div class="bg-gradient-to-r from-purple-500 to-pink-500 h-2 rounded-full" style="width:${rate}%"></div>
                        </div>
                        ${isAdmin ? `
                            <table class="w-full bg-white rounded-lg overflow-hidden">
                                <tr class="border-b">
                                    <th class="p-2 text-sm">ì‹œê°„</th>
                                    ${data.times.map((t,j) => `<th class="p-2"><input type="text" value="${t}" 
                                        onchange="data.times[${j}]=this.value;render()" 
                                        class="w-full px-2 py-1 border rounded text-center text-sm"></th>`).join('')}
                                </tr>
                                <tr class="border-b">
                                    <td class="p-2 text-sm">ì¡°íšŒìˆ˜</td>
                                    ${data.views[i].map((v,j) => `<td class="p-2"><input type="number" value="${v}" 
                                        onchange="data.views[${i}][${j}]=+this.value;render()" 
                                        class="w-full px-2 py-1 border rounded text-center"></td>`).join('')}
                                </tr>
                                <tr>
                                    <td class="p-2 text-sm text-gray-600">ì¦ê°€ëŸ‰</td>
                                    ${data.views[i].map((v,j) => {
                                        const inc = j > 0 ? v - data.views[i][j-1] : 0;
                                        return `<td class="p-2 text-center text-xs font-bold ${inc > 0 ? 'text-green-600' : 'text-gray-400'}">
                                            ${j > 0 ? '+' + fmt(inc) : '-'}
                                        </td>`;
                                    }).join('')}
                                </tr>
                            </table>
                        ` : `
                            <div class="grid grid-cols-5 gap-2 bg-white rounded-lg p-3">
                                ${data.times.map((t,j) => {
                                    const inc = j > 0 ? data.views[i][j] - data.views[i][j-1] : 0;
                                    const r = data.goals[i] > 0 ? Math.min((data.views[i][j] / data.goals[i]) * 100, 100) : 0;
                                    return `<div class="text-center">
                                        <div class="text-xs text-gray-600">${t}</div>
                                        <div class="font-bold">${fmt(data.views[i][j])}</div>
                                        ${j > 0 ? `<div class="text-xs text-green-600">+${fmt(inc)}</div>` : ''}
                                        <div class="text-xs font-bold text-purple-600">${r.toFixed(1)}%</div>
                                    </div>`;
                                }).join('')}
                            </div>
                        `}
                    </div>
                `;
            });

            html += '</div>';
            document.getElementById('songs').innerHTML = html;
            document.getElementById('avgRate').textContent = (totalRate / 12).toFixed(1) + '%';
        }

        function toggleAdmin() {
            if (isAdmin) {
                isAdmin = false;
                document.getElementById('adminBtn').textContent = 'ğŸ” ê´€ë¦¬ì';
                document.getElementById('saveBtn').classList.add('hidden');
                render();
            } else {
                document.getElementById('modal').classList.remove('hidden');
                document.getElementById('pwd').value = '';
                document.getElementById('error').classList.add('hidden');
            }
        }

        function login() {
            if (document.getElementById('pwd').value === '@minho0728') {
                isAdmin = true;
                document.getElementById('adminBtn').textContent = 'ğŸšª ë¡œê·¸ì•„ì›ƒ';
                document.getElementById('saveBtn').classList.remove('hidden');
                closeModal();
                render();
            } else {
                document.getElementById('error').textContent = 'ë¹„ë°€ë²ˆí˜¸ê°€ í‹€ë¦½ë‹ˆë‹¤';
                document.getElementById('error').classList.remove('hidden');
            }
        }

        function closeModal() {
            document.getElementById('modal').classList.add('hidden');
        }

        function saveData() {
            data.lastUpdate = new Date().toLocaleString('ko-KR');
            db.ref('tracker').set(data).then(() => alert('ì €ì¥ ì™„ë£Œ!'));
        }

        function copyLink() {
            navigator.clipboard.writeText(window.location.href.split('?')[0]);
            document.getElementById('copyText').textContent = 'ë³µì‚¬ë¨!';
            setTimeout(() => document.getElementById('copyText').textContent = 'ë§í¬ ë³µì‚¬', 2000);
        }

        document.getElementById('pwd').addEventListener('keypress', e => {
            if (e.key === 'Enter') login();
        });

        render();
    </script>
</body>
</html>



